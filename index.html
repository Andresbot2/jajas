<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script>
      AFRAME.registerComponent('limited-rotation', {
        schema: {
          minAngle: {type: 'number', default: -180},
          maxAngle: {type: 'number', default: 180},
          speed: {type: 'number', default: 20}, // grados por segundo
          axis: {type: 'string', default: 'y'}
        },
        
        init: function() {
          this.currentAngle = 0;
          this.direction = 1; // 1 para adelante, -1 para atrás
        },
        
        tick: function(time, timeDelta) {
          const data = this.data;
          const deltaSeconds = timeDelta / 1000;
          
          // Calcular nuevo ángulo
          this.currentAngle += data.speed * deltaSeconds * this.direction;
          
          // Verificar límites y cambiar dirección si es necesario
          if (this.currentAngle >= data.maxAngle) {
            this.currentAngle = data.maxAngle;
            this.direction = -1;
          } else if (this.currentAngle <= data.minAngle) {
            this.currentAngle = data.minAngle;
            this.direction = 1;
          }
          
          // Aplicar rotación
          const rotation = this.el.getAttribute('rotation');
          if (data.axis === 'y') {
            this.el.setAttribute('rotation', {x: rotation.x, y: this.currentAngle, z: rotation.z});
          } else if (data.axis === 'x') {
            this.el.setAttribute('rotation', {x: this.currentAngle, y: rotation.y, z: rotation.z});
          } else if (data.axis === 'z') {
            this.el.setAttribute('rotation', {x: rotation.x, y: rotation.y, z: this.currentAngle});
          }
        }
      });
    </script>
  </head>
  <body>
    <a-scene background="color: #ECECEC">
      
      <!-- Cámara con controles de movimiento WASD -->
      <a-entity id="rig" position="0 0 6">
        <a-entity 
          position="0 1.6 0" 
          camera 
          look-controls="pointerLockEnabled: true"
          wasd-controls="acceleration: 30">
        </a-entity>
      </a-entity>
      
      <!-- Luces -->
      <a-entity light="type: directional; intensity: 1" position="3 5 7"></a-entity>
      <a-entity light="type: ambient; intensity: 0.5"></a-entity>
      
      <!-- Suelo más grande para moverse -->
      <a-plane rotation="-90 0 0" width="20" height="20" color="#AAA"></a-plane>
      
      <!-- Cuadrícula para referencia visual -->
      <a-plane rotation="-90 0 0" width="20" height="20" 
               material="wireframe: true; color: #666"
               position="0 0.01 0"></a-plane>
      
      <!-- Modelo del brazo GP12_AR1440 con rotación limitada -->
      <a-entity id="robot" 
                gltf-model="GP12_AR1440.glb" 
                scale="0.5 0.5 0.5"
                position="0 0 0"
                rotation="0 0 0"
                limited-rotation="minAngle: -45; maxAngle: 45; speed: 20; axis: y">
      </a-entity>
      
      <!-- Bloque móvil -->
      <a-box id="moving-block"
             position="3 0.5 0"
             width="1" height="1" depth="1"
             color="#FF6B6B"
             animation="property: position; 
                        to: -3 0.5 0; 
                        from: 3 0.5 0;
                        dir: alternate; 
                        loop: true; 
                        dur: 4000; 
                        easing: easeInOutSine">
      </a-box>
      
      <!-- Marcadores de referencia -->
      <a-cylinder position="-2 0.5 0" radius="0.1" height="1" color="#FF0000"></a-cylinder>
      <a-cylinder position="2 0.5 0" radius="0.1" height="1" color="#00FF00"></a-cylinder>
      <a-cylinder position="0 0.5 -2" radius="0.1" height="1" color="#0000FF"></a-cylinder>
      <a-cylinder position="0 0.5 2" radius="0.1" height="1" color="#FFFF00"></a-cylinder>
    </a-scene>
  </body>
</html>
